<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Program Lentera Zyland: Fun LENTERA, LENTERA Focus, Zylearn, dan LENTERA Competition—terintegrasi Computational Thinking."/>
  <title>Program • Lentera Zyland</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet"/>

  <!-- Tailwind + Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>

  <link rel="icon" href="/img/icon.png" type="image/png" />

  <style>
    :root{
      --primary:#16a34a; /* hijau */
      --primary-700:#15803d;
      --secondary:#facc15; /* kuning */
      --ink:#0b1220;
      --paper:#ffffff;

      --ring:rgba(22,163,74,.14);
    }

    /* ==== OVERFLOW SAFEGUARDS (perbaikan mobile) ==== */
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ width:100%; max-width:100%; overflow-x:hidden; }
    header,main,footer{ width:100%; overflow-x:hidden; }

    body{ font-family:'Poppins',sans-serif; color:var(--ink); background:var(--paper); }

    /* hero (bersih tanpa tompel/mesh) */
    .hero{
      position:relative; isolation:isolate;
      background:#fff; /* polos */
    }

    /* micro-interactions */
    .card-hover{ transition:transform .28s ease, box-shadow .28s ease; }
    .card-hover:hover{ transform:translateY(-4px); }

    /* chips / filters */
    .chip{ cursor:pointer; user-select:none; }
    .chip-active{
      background:rgba(250,204,21,0.25);
      border-color:rgba(250,204,21,0.55) !important;
      color:#92400e;
    }

    /* accordion */
    details.program{
      border:1px solid #f3f4f6; /* gray-100 */
      border-radius:1rem;
      background:#fff;
      overflow:hidden;
    }
    details.program[open] .chev{ transform: rotate(180deg); }
    .chev{ transition: transform .25s ease; }

    /* CT badge */
    .chip-ct{
      background: rgba(22,163,74,.08);
      border:1px solid rgba(22,163,74,.18);
      color:#065f46;
    }

    /* Gallery */
    .thumb-active{ outline:none; box-shadow: inset 0 0 0 3px var(--secondary), 0 0 0 1px rgba(0,0,0,.04); }

    /* Reveal */
    @media (prefers-reduced-motion:no-preference){
      .reveal{ opacity:0; transform:translateY(14px); transition:opacity .6s ease, transform .6s ease; }
      .reveal.show{ opacity:1; transform:translateY(0); }
    }

    /* Responsive tweaks */
    @media (min-width: 1024px){
      .sidebar-sticky{ position: sticky; top: 5.5rem; }
    }
  </style>
</head>
<body class="antialiased text-gray-800 selection:bg-yellow-200 selection:text-gray-900 overflow-x-hidden">

  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <!-- Branding -->
        <a href="/" class="inline-flex items-center gap-2 group" aria-label="Beranda">
          <span class="inline-block h-8 w-1.5 rounded-full" style="background:var(--secondary)"></span>
          <span style="font-family:'Lobster',cursive" class="text-2xl leading-none text-gray-900">Lentera Zyland</span>
          <span class="ml-1 text-xs px-2 py-0.5 rounded-full border border-yellow-300 text-yellow-700 bg-yellow-50 hidden sm:inline-block">PKM</span>
        </a>

        <!-- Nav -->
        <nav class="hidden md:flex items-center gap-6">
          <a href="/" class="text-sm font-medium text-gray-700 hover:text-gray-900 transition">Home</a>
          <!-- <a href="/berita" class="text-sm font-medium text-gray-700 hover:text-gray-900 transition">Berita</a> -->
          <a href="/program" class="text-sm font-semibold text-gray-900 underline underline-offset-8 decoration-yellow-300">Program</a>
          <a href="/download" class="text-sm font-medium text-gray-700 hover:text-gray-900 transition">Download</a>
          <a href="/tentang" class="text-sm font-medium text-gray-700 hover:text-gray-900 transition">Tentang</a>
        </nav>

        <!-- CTA -->
        <div class="hidden md:flex items-center gap-3">
          <a href="https://instagram.com/lenterazyland" target="_blank" rel="noopener"
             class="inline-flex items-center gap-2 text-sm font-semibold px-4 py-2 rounded-xl border border-gray-200 text-gray-800 hover:bg-gray-50 transition"
             aria-label="Buka Instagram Lentera Zyland">
            <i class="fab fa-instagram text-sm opacity-90" aria-hidden="true"></i> Instagram
          </a>
        </div>

        <!-- Mobile menu -->
        <button id="menuBtn" type="button" class="md:hidden inline-flex items-center justify-center h-10 w-10 rounded-lg border border-gray-200"
                aria-label="Menu" aria-expanded="false" aria-controls="mobileMenu">
          <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
      </div>
    </div>

    <!-- Mobile panel -->
    <div id="mobileMenu" class="md:hidden hidden border-t border-gray-100 bg-white/95 backdrop-blur">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 grid gap-3">
        <a href="/" class="block py-2 text-gray-800 hover:text-gray-900">Home</a>
        <!-- <a href="/berita" class="block py-2 text-gray-800 hover:text-gray-900">Berita</a> -->
        <a href="/program" class="block py-2 text-gray-800 hover:text-gray-900 font-semibold underline underline-offset-8 decoration-yellow-300">Program</a>
        <a href="/download" class="block py-2 text-gray-800 hover:text-gray-900">Download</a>
        <a href="/tentang" class="block py-2 text-gray-800 hover:text-gray-900">Tentang</a>
        <a href="https://instagram.com/lenterazyland" target="_blank" rel="noopener"
           class="inline-flex items-center gap-2 justify-center text-sm font-semibold px-4 py-2 rounded-xl border border-gray-200 text-gray-800 hover:bg-gray-50 transition mt-2">
          <i class="fab fa-instagram text-sm opacity-90" aria-hidden="true"></i> Instagram
        </a>
      </div>
    </div>
  </header>

  <!-- Peta Program -->
  <section class="hero pt-10 sm:pt-14 pb-6 sm:pb-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="reveal text-center max-w-3xl mx-auto">
        <span class="inline-flex items-center gap-2 text-xs font-semibold px-3 py-1 rounded-full"
              style="background: rgba(22,163,74,.08); color: var(--primary); border:1px solid rgba(22,163,74,.18);">
          <i class="fas fa-toolbox" aria-hidden="true"></i> Peta Program
        </span>
        <h1 class="mt-3 text-2xl sm:text-3xl font-extrabold text-gray-900">Aktivitas Inklusif, Terstruktur, Seru.</h1>
        <p class="mt-2 text-gray-700">
          Jelajahi paket permainan, AR, lokakarya, dan kompetisi yang ditenagai <strong>Computational Thinking</strong>.
        </p>
        <div class="mt-4 flex flex-wrap justify-center gap-2">
          <span class="chip-ct inline-flex items-center text-xs px-2 py-1 rounded-md border"><i class="fas fa-cut mr-1" aria-hidden="true"></i> Decomposition</span>
          <span class="chip-ct inline-flex items-center text-xs px-2 py-1 rounded-md border"><i class="fas fa-shapes mr-1" aria-hidden="true"></i> Pattern Recognition</span>
          <span class="chip-ct inline-flex items-center text-xs px-2 py-1 rounded-md border"><i class="fas fa-layer-group mr-1" aria-hidden="true"></i> Abstraction</span>
          <span class="chip-ct inline-flex items-center text-xs px-2 py-1 rounded-md border"><i class="fas fa-stream mr-1" aria-hidden="true"></i> Algorithmic Thinking</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Spotlight Program (jarak rapi & heading kecil) -->
  <section class="pt-2 pb-6 sm:pb-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between mb-3 sm:mb-4">
        <div class="inline-flex items-center gap-2 text-xs font-semibold px-3 py-1 rounded-full bg-yellow-50 text-yellow-800 border border-yellow-200">
          <i class="fas fa-bolt" aria-hidden="true"></i> Spotlight Program
        </div>
        <a href="#accordion" class="text-xs sm:text-sm text-primary-700 hover:underline hidden sm:inline">Lihat daftar</a>
      </div>
      <div id="spotlight" class="reveal"></div>
    </div>
  </section>

  <!-- Main -->
  <main class="py-6 sm:py-10 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Sidebar filter -->
        <aside class="lg:col-span-4">
          <div class="sidebar-sticky space-y-4">
            <div class="bg-white p-4 rounded-2xl border border-gray-100">
              <label for="search" class="text-sm font-medium text-gray-900">Cari Program</label>
              <div class="mt-2 relative">
                <input id="search" type="text" placeholder="mis. AR, fokus, guru..."
                  class="w-full rounded-xl border border-gray-200 px-4 py-2.5 pr-9 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-200">
                <i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400" aria-hidden="true"></i>
              </div>
            </div>

            <div class="bg-white p-4 rounded-2xl border border-gray-100">
              <div class="flex items-center justify-between">
                <h3 class="text-sm font-medium text-gray-900">Kategori</h3>
                <button id="resetFilters" type="button" class="text-xs underline text-gray-500">Reset</button>
              </div>
              <div class="mt-3 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 gap-2">
                <button type="button" class="chip chip-active text-xs px-3 py-2 rounded-lg border border-gray-200 text-left" data-cat="Semua">Semua</button>
                <button type="button" class="chip text-xs px-3 py-2 rounded-lg border border-gray-200 text-left" data-cat="Fun LENTERA">Fun LENTERA</button>
                <button type="button" class="chip text-xs px-3 py-2 rounded-lg border border-gray-200 text-left" data-cat="LENTERA Focus">LENTERA Focus</button>
                <button type="button" class="chip text-xs px-3 py-2 rounded-lg border border-gray-200 text-left" data-cat="Zylearn">Zylearn</button>
                <button type="button" class="chip text-xs px-3 py-2 rounded-lg border border-gray-200 text-left" data-cat="LENTERA Competition">LENTERA Competition</button>
              </div>
            </div>

            <div class="bg-white p-4 rounded-2xl border border-gray-100">
              <label for="sort" class="text-sm font-medium text-gray-900">Urutkan</label>
              <select id="sort" class="mt-2 w-full rounded-xl border border-gray-200 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-200">
                <option value="featured">Pilihan</option>
                <option value="az">A — Z</option>
                <option value="za">Z — A</option>
              </select>
              <button id="toggleAll" type="button" class="mt-3 w-full inline-flex items-center justify-center gap-2 text-sm font-semibold px-3 py-2 rounded-xl border border-gray-200 hover:bg-gray-50 transition">
                <i class="fas fa-chevron-down chev" aria-hidden="true"></i> Expand semua
              </button>
            </div>

            <div class="text-sm text-gray-500"><span id="resultCount" aria-live="polite">0</span> program ditampilkan</div>
          </div>
        </aside>

        <!-- Accordion daftar program -->
        <section class="lg:col-span-8">
          <div id="accordion" class="space-y-4"></div>
        </section>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-t border-gray-100 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="py-10 grid grid-cols-1 sm:grid-cols-3 gap-8">
        <div class="reveal show">
          <h3 class="font-semibold text-gray-900">Lentera Zyland</h3>
          <p class="mt-2 text-sm text-gray-600">Inovasi pembelajaran inklusif melalui game edukasi berlandaskan Computational Thinking</p>
          <div class="mt-3 flex items-center gap-3 text-gray-500">
            <a href="https://www.instagram.com/lenterazyland" class="hover:text-gray-800" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
            <a href="https://www.youtube.com/@PKM-PMLenteraZyland" class="hover:text-gray-800" aria-label="YouTube"><i class="fab fa-youtube" aria-hidden="true"></i></a>
            <a href="https://www.tiktok.com/@pkmpm.lenterazyland" class="hover:text-gray-800" aria-label="TikTok"><i class="fab fa-tiktok" aria-hidden="true"></i></a>
          </div>
        </div>
        <div class="reveal show">
          <h4 class="font-semibold text-gray-900">Navigasi</h4>
          <ul class="mt-2 text-sm text-gray-600 space-y-1">
            <li><a href="/" class="hover:text-gray-900">Home</a></li>
            <!-- <li><a href="/berita" class="hover:text-gray-900">Berita</a></li> -->
            <li><a href="/program" class="hover:text-gray-900">Program</a></li>
            <li><a href="/download" class="hover:text-gray-900">Download</a></li>
            <li><a href="/tentang" class="hover:text-gray-900">Tentang</a></li>
          </ul>
        </div>
        <div class="reveal show">
          <h4 class="font-semibold text-gray-900">Kontak</h4>
          <ul class="mt-2 text-sm text-gray-600 space-y-1">
            <li>Email: <a href="mailto:lenterazyland1@gmail.com">lenterazyland1@gmail.com</a></li>
            <li>Alamat: Surakarta</li>
          </ul>
        </div>
      </div>
      <div class="py-4 border-t border-gray-100 text-xs text-gray-500 flex items-center justify-between">
        <span>© <span id="year"></span> Lentera Zyland • All rights reserved.</span>
      </div>
    </div>
  </footer>

  <!-- Script -->
  <script>
    // Tahun footer
    document.getElementById('year').textContent = new Date().getFullYear();

    // Mobile menu
    const menuBtn = document.getElementById('menuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    if(menuBtn){
      menuBtn.addEventListener('click', () => {
        const expanded = menuBtn.getAttribute('aria-expanded') === 'true';
        menuBtn.setAttribute('aria-expanded', String(!expanded));
        mobileMenu.classList.toggle('hidden');
      });
    }

    // ===== Data Program (granular per sub-program) =====
    const PROGRAMS = [
      // === Fun LENTERA (4 item) ===
      {
        id:"fun-number-board",
        title:"Number Board",
        category:"Fun LENTERA",
        audience:["Siswa SD","Slow Learner"],
        excerpt:"Latihan berhitung bertahap, urutan, dan pola bilangan secara menyenangkan.",
        ct:["Pattern Recognition","Algorithmic Thinking"],
        points:[
          "Board bertingkat: dari pengenalan angka ke operasi sederhana",
          "Memperkuat konsep urutan & pola (skip counting)"
        ],
        images:["/img/fun-number-board-1.jpg","/img/fun-number-board-2.jpg"],
        image:"/img/fun-number-board-1.jpg",
        featured:false
      },
      {
        id:"fun-book-storytime",
        title:"Book Storytime",
        category:"Fun LENTERA",
        audience:["Siswa SD","Slow Learner"],
        excerpt:"Penguatan literasi: kosa kata, pemahaman bacaan, dan storytelling terpandu.",
        ct:["Abstraction","Decomposition"],
        points:[
          "Menyederhanakan alur cerita (tokoh, tempat, masalah, solusi)",
          "Aktivitas tanya-jawab & menceritakan kembali (retelling)"
        ],
        images:["/img/fun-storytime-1.jpg","/img/fun-storytime-2.jpg"],
        image:"/img/fun-storytime-1.jpg",
        featured:false
      },
      {
        id:"fun-find-word-number",
        title:"Find Word and Number",
        category:"Fun LENTERA",
        audience:["Siswa SD","Slow Learner"],
        excerpt:"Permainan mencari kata/angka untuk melatih fokus, memori kerja, dan pencocokan pola.",
        ct:["Pattern Recognition"],
        points:[
          "Teka-teki huruf/angka dengan tingkat kesulitan bertahap",
          "Melatih atensi selektif & pemindaian visual"
        ],
        images:["/img/fun-find-1.jpg","/img/fun-find-2.jpg"],
        image:"/img/fun-find-1.jpg",
        featured:false
      },
      {
        id:"fun-zyland-game",
        title:"ZYLAND – Game Edukasi",
        category:"Fun LENTERA",
        audience:["Siswa SD","Slow Learner"],
        excerpt:"Petualangan interaktif dengan misi CT per level (dekomposisi, pola, algoritma).",
        ct:["Decomposition","Algorithmic Thinking","Pattern Recognition"],
        points:[
          "Quest & checkpoint yang memandu langkah-langkah pemecahan masalah",
          "Umpan balik instan & progres yang bisa dilacak"
        ],
        images:["/img/zyland.jpg","/img/game-zyland/gambar1.jpg","/img/game-zyland/gambar1.jpg"],
        image:"/img/fun-zyland-1.jpg",
        featured:true   // highlight default
      },

      // === LENTERA Focus (2 item) ===
      {
        id:"focus-tower",
        title:"Menara Focus",
        category:"LENTERA Focus",
        audience:["Siswa SD","Remedial/Intervensi"],
        excerpt:"Aktivitas stacking/menara bertingkat untuk atensi berkelanjutan & kontrol impuls.",
        ct:["Algorithmic Thinking","Decomposition"],
        points:[
          "Aturan sederhana → kompleks (level up)",
          "Refleksi singkat pasca aktivitas (metakognisi)"
        ],
        images:["/img/focus-tower-1.jpg","/img/focus-tower-2.jpg"],
        image:"/img/focus-tower-1.jpg",
        featured:false
      },
      {
        id:"focus-teams-tournament",
        title:"Teams Tournament Number and Words",
        category:"LENTERA Focus",
        audience:["Siswa SD"],
        excerpt:"Turnamen tim angka & kata untuk kolaborasi, strategi, dan regulasi diri.",
        ct:["Algorithmic Thinking","Pattern Recognition"],
        points:[
          "Format gim tim dengan skor & putaran",
          "Melatih komunikasi & pengambilan keputusan"
        ],
        images:["/img/focus-tournament-1.jpg","/img/focus-tournament-2.jpg"],
        image:"/img/focus-tournament-1.jpg",
        featured:false
      },

      // === Zylearn (1 item) ===
      {
        id:"zylearn-training",
        title:"Zylearn — Pelatihan Guru",
        category:"Zylearn",
        audience:["Guru","Orang Tua"],
        excerpt:"Pelatihan adopsi Computational Thinking di kelas & rumah.",
        ct:["Decomposition","Pattern Recognition","Abstraction","Algorithmic Thinking"],
        points:[
          "Template aktivitas CT & diferensiasi pembelajaran",
          "Micro-teaching & pendampingan implementasi"
        ],
        images:["/img/zylearn-1.jpg","/img/zylearn-2.jpg","/img/zylearn-3.jpg"],
        image:"/img/zylearn-1.jpg",
        featured:false
      },

      // === LENTERA Competition (1 item) ===
      {
        id:"competition-main",
        title:"LENTERA Competition",
        category:"LENTERA Competition",
        audience:["Siswa SD","Komunitas"],
        excerpt:"Event kompetisi untuk mengapresiasi capaian CT & numerasi.",
        ct:["Algorithmic Thinking","Pattern Recognition"],
        points:[
          "Misi dengan rubrik penilaian transparan",
          "Showcase portofolio & demo AR + penghargaan"
        ],
        images:["/img/competition-1.jpg","/img/competition-2.jpg"],
        image:"/img/competition-1.jpg",
        featured:false
      }
    ];

    // ===== Helpers =====
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const accordion = $('#accordion');
    const spotlight = $('#spotlight');
    const resultCount = $('#resultCount');
    const search = $('#search');
    const sort = $('#sort');
    const chips = $$('.chip');
    const resetFilters = $('#resetFilters');
    const toggleAllBtn = $('#toggleAll');

    const iconByCat = {
      "Fun LENTERA": "fas fa-gamepad",
      "LENTERA Focus": "fas fa-bullseye",
      "Zylearn": "fas fa-chalkboard-teacher",
      "LENTERA Competition": "fas fa-trophy"
    };
    const ctIcon = {
      "Decomposition":"fas fa-cut",
      "Pattern Recognition":"fas fa-shapes",
      "Abstraction":"fas fa-layer-group",
      "Algorithmic Thinking":"fas fa-stream"
    };

    const ctBadge = (name) =>
      `<span class="inline-flex items-center text-xs px-2 py-1 rounded-md bg-gray-50 border border-gray-200 text-gray-700">
        <i class="${ctIcon[name]||''} mr-1" aria-hidden="true"></i>${name}
      </span>`;

    // ===== State =====
    let state = { q:"", cat:"Semua", sort:"featured", expanded:false };
    const galleryIndex = {}; // { [id]: number }

    // ===== Spotlight render (prioritaskan Zyland) =====
    function renderSpotlight(list=PROGRAMS){
      const zyDefault = PROGRAMS.find(p => p.id === 'fun-zyland-game');
      const item = (list.find(p => p.id === 'fun-zyland-game')) || zyDefault || (list.find(p=>p.featured) || list[0]);

      if(!item){ spotlight.innerHTML = ""; return; }
      const cover = (item.images && item.images[0]) || item.image;
      spotlight.innerHTML = `
        <article class="rounded-3xl overflow-hidden border border-gray-100 shadow-sm card-hover relative">
          <div class="absolute inset-0" aria-hidden="true"
               style="background: linear-gradient(to right, rgba(0,0,0,.55), rgba(0,0,0,.15)); z-index:1;"></div>
          <img src="${cover}" alt="${item.title}" loading="lazy" decoding="async" width="1280" height="720"
               class="w-full h-56 sm:h-64 md:h-72 lg:h-80 xl:h-[22rem] object-cover"/>
          <div class="absolute inset-0 z-10 flex items-end">
            <div class="p-4 sm:p-6 md:p-8 text-white max-w-3xl">
              <div class="flex items-center gap-2 text-xs">
                <span class="inline-flex items-center gap-2 px-2 py-1 rounded-md bg-white/15 backdrop-blur border border-white/20">
                  <i class="${iconByCat[item.category]||'fas fa-layer-group'}" aria-hidden="true"></i> ${item.category}
                </span>
                <span class="inline-flex items-center gap-2 px-2 py-1 rounded-md bg-yellow-400/90 text-gray-900 font-semibold">
                  <i class="fas fa-star" aria-hidden="true"></i> Highlight
                </span>
              </div>
              <h2 class="mt-2 text-2xl sm:text-3xl font-extrabold">${item.title}</h2>
              <p class="mt-2 text-sm sm:text-base text-white/90">${item.excerpt}</p>
              <div class="mt-3 flex flex-wrap gap-2">
                ${item.ct.map(ctBadge).join('')}
              </div>
            </div>
          </div>
        </article>
      `;
    }

    // ===== Filtering/Sorting =====
    const getFiltered = () => {
      let items = PROGRAMS.slice();

      if(state.cat !== "Semua"){
        items = items.filter(p => p.category === state.cat);
      }
      if(state.q.trim()){
        const q = state.q.toLowerCase();
        items = items.filter(p =>
          p.title.toLowerCase().includes(q) ||
          p.excerpt.toLowerCase().includes(q) ||
          p.points.some(pt => pt.toLowerCase().includes(q)) ||
          p.audience.join(" ").toLowerCase().includes(q)
        );
      }
      if(state.sort === "az"){
        items.sort((a,b)=> a.title.localeCompare(b.title));
      }else if(state.sort === "za"){
        items.sort((a,b)=> b.title.localeCompare(a.title));
      }else{
        items.sort((a,b)=> (b.featured===true) - (a.featured===true));
      }
      return items;
    };

    // ===== Gallery helpers =====
    function updateGallery(id, idx){
      const container = document.getElementById('gal-'+id);
      if(!container) return;
      const data = PROGRAMS.find(p=>p.id===id);
      if(!data) return;

      galleryIndex[id] = (idx + data.images.length) % data.images.length; // wrap
      const current = galleryIndex[id];

      const hero = container.querySelector('.gal-hero');
      hero.setAttribute('src', data.images[current]);

      container.querySelectorAll('.gal-thumb').forEach((btn, i)=>{
        const active = i===current;
        btn.classList.toggle('thumb-active', active);
        btn.setAttribute('aria-current', active ? 'true' : 'false');
      });
    }

    // ===== Accordion render =====
    function renderAccordion(){
      const items = getFiltered();
      resultCount.textContent = items.length;

      if(!items.length){
        accordion.innerHTML = `
          <div class="mt-6 text-center text-gray-500">
            <i class="fas fa-puzzle-piece text-3xl mb-3" aria-hidden="true"></i>
            <p>Tidak ada program yang cocok dengan pencarian/filters.</p>
          </div>
        `;
        renderSpotlight([]);
        return;
      }

      renderSpotlight(items);

      accordion.innerHTML = items.map(p => {
        const cover = (p.images && p.images[0]) || p.image;
        galleryIndex[p.id] = 0;

        return `
        <details class="program bg-white reveal show">
          <summary class="list-none cursor-pointer select-none">
            <div class="flex items-start gap-3 p-4 sm:p-5">
              <div class="shrink-0 w-10 h-10 grid place-content-center rounded-lg"
                   style="background: rgba(250,204,21,0.25);">
                <i class="${iconByCat[p.category]||'fas fa-layer-group'} text-yellow-600" aria-hidden="true"></i>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 flex-wrap">
                  <span class="text-[11px] px-2 py-1 rounded-full bg-yellow-50 text-yellow-700 border border-yellow-200">${p.category}</span>
                </div>
                <h3 class="mt-1 font-semibold text-gray-900 text-base sm:text-lg">${p.title}</h3>
                <p class="mt-1 text-sm text-gray-600">${p.excerpt}</p>
              </div>
              <i class="fas fa-chevron-down chev text-gray-400 mt-1" aria-hidden="true"></i>
            </div>
          </summary>

          <!-- panel -->
          <div class="px-4 sm:px-5 pb-5">
            <div class="rounded-xl border border-gray-100 bg-gray-50 p-4">
              <div class="flex flex-wrap gap-2">
                ${p.ct.map(ctBadge).join('')}
              </div>
              <ul class="mt-3 space-y-2 text-sm text-gray-700 list-disc pl-5">
                ${p.points.map(li=>`<li>${li}</li>`).join('')}
              </ul>
              <div class="mt-3 text-xs text-gray-500">Audiens: ${p.audience.join(", ")}</div>
            </div>

            <!-- GALERI BESAR -->
            <div id="gal-${p.id}" class="mt-5">
              <div class="relative rounded-2xl overflow-hidden border border-gray-100">
                <img src="${cover}" alt="${p.title}" loading="lazy" decoding="async" width="1280" height="720"
                     class="gal-hero w-full h-56 sm:h-64 md:h-72 lg:h-[26rem] object-cover"/>
                <button type="button" class="gal-prev absolute left-3 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/90 border border-gray-200 shadow-sm hover:bg-white transition" aria-label="Sebelumnya" data-id="${p.id}">
                  <i class="fas fa-chevron-left" aria-hidden="true"></i>
                </button>
                <button type="button" class="gal-next absolute right-3 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/90 border border-gray-200 shadow-sm hover:bg-white transition" aria-label="Berikutnya" data-id="${p.id}">
                  <i class="fas fa-chevron-right" aria-hidden="true"></i>
                </button>
              </div>
              <!-- Thumbnails -->
              <div class="mt-3 flex gap-2 overflow-x-auto">
                ${p.images.map((src, i)=>`
                  <button type="button" class="gal-thumb ${i===0?'thumb-active':''} shrink-0 rounded-xl overflow-hidden border border-gray-200" data-idx="${i}" data-id="${p.id}" aria-label="Gambar ${i+1}">
                    <img src="${src}" alt="Thumb ${i+1} ${p.title}" loading="lazy" decoding="async" width="240" height="160" class="h-16 w-24 object-cover" draggable="false"/>
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        </details>
      `}).join('');

      $$('.program', accordion).forEach(d => d.open = state.expanded);
      toggleAllBtn.innerHTML = state.expanded
        ? '<i class="fas fa-chevron-up chev" aria-hidden="true"></i> Collapse semua'
        : '<i class="fas fa-chevron-down chev" aria-hidden="true"></i> Expand semua';
    }

    // ===== Events =====
    const debounce = (fn, ms=250) => { let t; return (...args) => { clearTimeout(t); t=setTimeout(()=>fn(...args), ms);} };

    search.addEventListener('input', debounce((e)=>{
      state.q = e.target.value || "";
      state.expanded = false;
      renderAccordion();
    }, 200));

    sort.addEventListener('change', e => {
      state.sort = e.target.value;
      state.expanded = false;
      renderAccordion();
    });

    chips.forEach(ch => {
      ch.addEventListener('click', ()=>{
        chips.forEach(c => c.classList.remove('chip-active'));
        ch.classList.add('chip-active');
        state.cat = ch.dataset.cat;
        state.expanded = false;
        renderAccordion();
      });
    });

    resetFilters.addEventListener('click', ()=>{
      state = { q:"", cat:"Semua", sort:"featured", expanded:false };
      search.value = "";
      sort.value = "featured";
      chips.forEach(c => c.classList.toggle('chip-active', c.dataset.cat === 'Semua'));
      renderAccordion();
    });

    toggleAllBtn.addEventListener('click', ()=>{
      state.expanded = !state.expanded;
      $$('.program', accordion).forEach(d => d.open = state.expanded);
      toggleAllBtn.innerHTML = state.expanded
        ? '<i class="fas fa-chevron-up chev" aria-hidden="true"></i> Collapse semua'
        : '<i class="fas fa-chevron-down chev" aria-hidden="true"></i> Expand semua';
    });

    // Gallery controls
    document.addEventListener('click', (e)=>{
      const prev = e.target.closest('.gal-prev');
      const next = e.target.closest('.gal-next');
      const thumb = e.target.closest('.gal-thumb');

      if(prev){
        const id = prev.dataset.id;
        const data = PROGRAMS.find(p=>p.id===id);
        if(!data) return;
        updateGallery(id, (galleryIndex[id]||0) - 1);
      }
      if(next){
        const id = next.dataset.id;
        const data = PROGRAMS.find(p=>p.id===id);
        if(!data) return;
        updateGallery(id, (galleryIndex[id]||0) + 1);
      }
      if(thumb){
        const id = thumb.dataset.id;
        const idx = +thumb.dataset.idx;
        updateGallery(id, idx);
      }
    });

    // Keyboard nav (saat fokus di tombol galeri)
    document.addEventListener('keydown', (e)=>{
      if(e.key !== 'ArrowLeft' && e.key !== 'ArrowRight') return;
      const focused = document.activeElement;
      if(!focused) return;
      const galBtn = focused.closest('#accordion .gal-prev, #accordion .gal-next, #accordion .gal-thumb');
      if(!galBtn) return;
      const id = galBtn.dataset.id;
      if(!id) return;
      if(e.key === 'ArrowLeft') updateGallery(id, (galleryIndex[id]||0) - 1);
      if(e.key === 'ArrowRight') updateGallery(id, (galleryIndex[id]||0) + 1);
    });

    // Reveal on scroll (IntersectionObserver)
    (function(){
      const els = $$('.reveal');
      if (!('IntersectionObserver' in window) || !els.length) {
        els.forEach(el => el.classList.add('show'));
        return;
      }
      const io = new IntersectionObserver((entries, obs) => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            e.target.classList.add('show');
            obs.unobserve(e.target);
          }
        });
      }, { rootMargin: '0px 0px -10% 0px', threshold: 0.06 });
      els.forEach(el => io.observe(el));
    })();

    // First render
    renderAccordion();
  </script>
</body>
</html>
